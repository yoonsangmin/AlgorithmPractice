# AStarCraft

C++ 콘솔 엔진을 이용한 알고리즘 연습 프로젝트

### 진행 기간 
2025.2.24-2025.2.26

### 영상
[![AStarCraft](https://github.com/user-attachments/assets/5a7a0772-cf6e-4f5e-95d7-60c65ad558af)](https://youtu.be/ciy20ff_W3I)


### 기술 스택
- C++, STL, Windows 콘솔, 파일 파싱, 콘솔 마우스 입력 처리, A* 알고리즘

### 프로젝트 진행 단계
1. 기획 및 설계
- 프로젝트 기획과 구현 목표 설정
- 클래스 구조 설계
2. 맵 로딩 및 경로 탐색 시스템 구현
- 텍스트 파일을 통한 맵 파싱 및 로딩
- A* 알고리즘 구현 (NavigationSystem 클래스)
- 이동 가능한 영역 캐싱 및 간단한 충돌 처리
3. 유닛 및 이동 시스템 구현
- 유닛 클래스 설계 및 구현 - 입력을 담당하는 Player 클래스와 화면에서 이동하는 객체인 Unit 클래스 분리
- 마우스 입력을 통한 유닛 선택 및 이동 기능 추가
- A* 알고리즘을 이용한 유닛 경로 추적 및 실시간 이동 구현
- Marker 클래스를 구현하여 찾은 경로를 직관적으로 표시하는 기능과 사용 가능한 입력을 표시하는 UI 구현
4. 최적화 및 성능 개선
- A* 알고리즘 최적화 (STL 라이브러리의 std::priority_queue(우선순위 큐)와 std::unordered_map(해쉬 테이블)을 활용)
- 많은 유닛을 조작할 수 있도록 마우스 드래그를 통한 유닛 선택 구현
- 목표 지점에 도달할 수 없는 경우 목표 지점과 가까운 대체 목적지를 선택하도록 구현
5. 버그 수정 및 최종 테스트
- 게임 플레이 중 발생한 버그 수정
- 실시간 유닛 간의 충돌 처리 및 경로 찾기 기능의 안정성 테스트

### 문제 해결 과정 
- A* 알고리즘에서 무한 루프 발생
  - 실시간 길찾기 처리 중 게임이 멈추는 문제 발견했습니다.
  - 무한 루프를 예상하고 디버그 모드에서 길 찾기 시스템 클래스의 모든 while 문에서 중단점을 찍으며 확인했습니다.
  - unordered_map을 사용할 때, 존재하지 않는 키에 접근하면 새로운 요소가 추가되어 예상치 못한 값이 들어가는 문제가 발생한 원인 확인했습니다.
  - 해시 기반 컨테이너 사용 시 find를 사용해 안전하게 확인 후 사용해야 함을 학습했습니다.
- 실시간 유닛 이동에서 경로 탐색 실패 시 문제
  - 길 찾기 후 이동 시에 다른 실시간 물체에 의해 길이 막혀 목표 지점으로 이동하지 못하는 문제를 발견했습니다.
  - 경로로 이동 중에 다른 물체에 의해 막힌 경우 다시 새로운 경로를 찾도록 수정했습니다.
  - 너무 많은 시도를 하기 때문에 여러 유닛을 한 번에 이동할 시에 안정화되지 않고 계속 새로운 목적지를 선택하는 문제가 다시 발생했습니다.
  - 따라서 최대 경로 탐색 시도 횟수를 설정해 목적지 주변에서 물체가 멈출 수 있도록 했습니다.
 

### 개선할 사항 
- 유닛이 이동할 때 겹 많은 겹쳐있는 경우 최대 시도 횟수를 넘어도 여전히 이동할 수 없는 경우가 존재합니다. 낮은 빈도로 경로 재탐색을 도입하고 목적지와 가까워진 경우 재탐색을 하지 않도록 구현하면 좋을 것 같습니다.
- 액터의 충돌을 구현하지 않고 Level 클래스에 이동 가능한 위치와 불가능한 위치를 기록하는 방식으로 구현되어 있습니다. 액터가 이동 가능한 위치에 대한 기록하는 방식은 최적화 측면에서는 좋았던 것 같지만 액터 이동 시에 처리해주는 부분의 코드가 지저분하게 작성되어 가독성이 떨어집니다. 코드 가독성을 더 개선하고 실제 물체간의 충돌을 구현을 했다면 좋았을 것 같습니다.
- 쿼드트리를 사용한 충돌 구현을 했다면 좋을 것 같습니다. 현재는 드래그해서 유닛을 선택하는 부분에서 Level의 모든 액터를 확인하도록 구현이 되어있습니다. 현재 프로젝트에선 많은 액터가 있지 않아 괜찮으나 쿼드트리를 사용해 충돌을 처리했다면 최적화가 가능했을 것 같습니다.
